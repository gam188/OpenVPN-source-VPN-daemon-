LyoNCiAqIG1zdmMtZ2VuZXJhdGUuanMgIC0gc3RyaW5nIHRyYW5zZm9ybWF0aW9uDQogKg0KICogQ29weXJpZ2h0IChDKSAyMDA4LTIwMTIgQWxvbiBCYXItTGV2IDxhbG9uLmJhcmxldkBnbWFpbC5jb20+DQogKg0KICogQlNEIExpY2Vuc2UNCiAqID09PT09PT09PT09PQ0KICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0DQogKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoNCiAqDQogKiAgICAgbyBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsDQogKiAgICAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLg0KICogICAgIG8gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQNCiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUNCiAqICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uDQogKiAgICAgbyBOZWl0aGVyIHRoZSBuYW1lIG9mIHRoZSBBbG9uIEJhci1MZXYgbm9yIHRoZSBuYW1lcyBvZiBpdHMNCiAqICAgICAgIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tDQogKiAgICAgICB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLg0KICoNCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIg0KICogQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQ0KICogSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UNCiAqIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRQ0KICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUg0KICogQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YNCiAqIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUw0KICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4NCiAqIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpDQogKiBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRQ0KICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuDQogKg0KICovDQoNCnZhciBGb3JSZWFkaW5nID0gMTsNCnZhciBmc28gPSBuZXcgQWN0aXZlWE9iamVjdCgiU2NyaXB0aW5nLkZpbGVTeXN0ZW1PYmplY3QiKTsNCnZhciBpbnB1dCA9ICJudWwiOw0KdmFyIG91dHB1dCA9ICJudWwiOw0KdmFyIGZpbGVzID0gbmV3IEFycmF5KCk7DQp2YXIgZW52ID0gbmV3IEFycmF5KCk7DQoNCmZ1bmN0aW9uIGluaXRpYWxpemUoKSB7DQoJZm9yICh2YXIgaT0wO2k8V1NjcmlwdC5Bcmd1bWVudHMubGVuZ3RoO2krKykgew0KCQl2YXIgYXJnID0gV1NjcmlwdC5Bcmd1bWVudHMoaSk7DQoJCWlmIChhcmcubWF0Y2goL14tLWlucHV0PSguKikkLykpIHsNCgkJCWlucHV0PVJlZ0V4cC4kMTsNCgkJfQ0KCQllbHNlIGlmIChhcmcubWF0Y2goL14tLW91dHB1dD0oLiopJC8pKSB7DQoJCQlvdXRwdXQ9UmVnRXhwLiQxOw0KCQl9DQoJCWVsc2UgaWYgKGFyZy5tYXRjaCgvXi0tY29uZmlnPSguKikkLykpIHsNCgkJCWZpbGVzLnB1c2goUmVnRXhwLiQxKTsNCgkJfQ0KCQllbHNlIGlmIChhcmcubWF0Y2goL14tLXZhcj0oW149XSopPSguKikkLykpIHsNCgkJCWVudltSZWdFeHAuJDFdID0gUmVnRXhwLiQyOw0KCQl9DQoJfQ0KfQ0KDQpmdW5jdGlvbiBwcm9jZXNzX2NvbmZpZyh2YXJzLCBmaWxlKSB7DQoJdHJ5IHsNCgkJdmFyIGZpbiA9IGZzby5PcGVuVGV4dEZpbGUoZmlsZSwgRm9yUmVhZGluZyk7DQoNCgkJd2hpbGUgKCFmaW4uQXRFbmRPZlN0cmVhbSkgew0KCQkJdmFyIGNvbnRlbnQgPSBmaW4uUmVhZExpbmUoKTsNCgkJCWlmIChjb250ZW50Lm1hdGNoKC9eWyBcdF0qZGVmaW5lXChcWyguKilcXSxbIFx0XSpcWyguKilcXVwpWyBcdF0qLykpIHsNCgkJCQl2YXJzW1JlZ0V4cC4kMV0gPSBSZWdFeHAuJDI7DQoJCQl9DQoJCX0NCgl9DQoJY2F0Y2goZSkgew0KCQl0aHJvdyBuZXcgRXJyb3IoMSwgIkNhbm5vdCBwcm9jZXNzICciICsgZmlsZSArICInLiIpOw0KCX0NCn0NCg0KZnVuY3Rpb24gcHJvY2Vzc19maWxlKHZhcnMsIGlucHV0LCBvdXRwdXQpIHsNCgl2YXIgZmluID0gZnNvLk9wZW5UZXh0RmlsZShpbnB1dCwgRm9yUmVhZGluZyk7DQoJdmFyIGZvdXQgPSBmc28uQ3JlYXRlVGV4dEZpbGUob3V0cHV0KTsNCgl2YXIgY29udGVudCA9IGZpbi5SZWFkQWxsKCk7DQoNCglmb3IgKHZhciBpIGluIHZhcnMpIHsNCgkJY29udGVudCA9IGNvbnRlbnQucmVwbGFjZShuZXcgUmVnRXhwKCJAIitpKyJAIiwgImciKSwgdmFyc1tpXSk7DQoJfQ0KDQoJZm91dC5Xcml0ZShjb250ZW50KTsNCn0NCg0KZnVuY3Rpb24gYnVpbGRfdmFycygpIHsNCgl2YXIgdmFycyA9IG5ldyBBcnJheSgpOw0KCWZvciAodmFyIGYgaW4gZmlsZXMpIHsNCgkJcHJvY2Vzc19jb25maWcodmFycywgZmlsZXNbZl0pOw0KCX0NCglmb3IgKHZhciBlIGluIGVudikgew0KCQl2YXJzW2VdID0gZW52W2VdOw0KCX0NCglyZXR1cm4gdmFyczsNCn0NCg0KZnVuY3Rpb24gbWFpbigpIHsNCgl0cnkgew0KCQlpbml0aWFsaXplKCk7DQoNCgkJdmFyIHZhcnMgPSBidWlsZF92YXJzKCk7DQoNCgkJcHJvY2Vzc19maWxlKA0KCQkJdmFycywNCgkJCWlucHV0LA0KCQkJb3V0cHV0DQoJCSk7DQoNCgkJV1NjcmlwdC5RdWl0KDApOw0KCX0NCgljYXRjaChlKSB7DQoJCVdTY3JpcHQuRWNobygiRVJST1I6IHdoZW4gcHJvY3NzaW5nICIgKyBvdXRwdXQgKyAiOiAiICsgZS5kZXNjcmlwdGlvbik7DQoJCVdTY3JpcHQuUXVpdCgxKTsNCgl9DQp9DQoNCm1haW4oKTsNCg